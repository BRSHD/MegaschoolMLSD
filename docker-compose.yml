version: "3.9"
services:
  megaschool:
    build: .
    ports:
      - "8000:8000"
    environment:
      GPU_ONLY: "1"
      CV_USE_GPU: "1"
      LLAMA_REQUIRE_GPU: "1"
      LLAMA_GPU_LAYERS: "-1"
      LLAMA_BATCH: "128"
      LLAMA_CTX: "1024"
      LLAMA_MAX_TOKENS: "200"
      CV_OCR_SCALE: "1.3"
      CV_OCR_DET_LIMIT: "640"
      CV_OCR_USE_ANGLE: "0"
      CV_YOLO_IMG: "960"
      MAX_REQUEST_SECONDS: "20"
      LOG_LEVEL: "INFO"
      LOG_JSON: "1"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
